#Модуль для Битрикс «Быстрая админка»
##Описание
Быстрая админка  - это фреймворк,  позволяющий быстро настроить и запустить административную часть для вашего модуля.  Всю работу по отрисовке Быстра админка берет на себя. Вам нужно только продумать расположение полей и дать им имена, по которым вы сможете получать их значения. Фреймворк позволяет располагать элементы на вкладках, а так же поддерживает создание пресетов и возможность создания уникальных настроек для каждого сайта.
##Использование
Чтобы подключить фреймворк к вашему модулю, необходимо создать 2 файла.
###Файл `options.php`
Файл `options.php` входит в стандартный дистрибутив любого модуля, в нём обычно находится логика, отвечающая за административную часть модуля и работу с его настройками. Для подключения Быстрой Админки этот файл должен иметь следующий вид:
	
	use \Bitrix\Main\Localization\Loc;
	use \Bitrix\Main\SystemException;
	use \Bitrix\Main\Loader;
	use \Rover\Fadmin\Admin\Panel;
	/**
	 * Имя вашего класса, унаследованного от \Rover\Fadmin\Options
	 */
	use \Rover\Fadmin\TestOptions;
	
	if (!Loader::includeModule($mid)
	   || !Loader::includeModule('rover.fadmin))
	   throw new SystemException('module "' . $mid . '" not found!');
	
	Loc::loadMessages(__FILE__);
	Loc::loadMessages($_SERVER["DOCUMENT_ROOT"] . "/bitrix/modules/main/options.php");
	
	(new Panel(TestOptions::getInstance($mid)))-\>show();
###Файл с вашими настройками
В папке `lib` вашего модуля вам необходимо создать файл с классом, который будет отвечать за настройки вашего модуля. Этот класс должен быть унаследован от `\Rover\Fadmin\Options` и реализовывать публичный метод `getConfig()`.

В самом фреймворке есть демо-файл `rover.fadmin/lib/testoptions.php`, в котором приведен пример такого класса. Страницу настроек, которая получается в итоге, вы можете найти в административной части сайта в разделе «Настройки» -> «Настройки продукта» -> «Настройки модулей» -> «Быстрая админка».
##Структура класса с настройками
Разберем структуру массива, возвращаемого методом `getConfig()` демо-класса `Rover\Fadmin\TestOptions`.
	
	namespace Rover\Fadmin;
	
	use Rover\Fadmin\Inputs\Input;
	
	class TestOptions extends Options
	{
	    public function getConfig()
	    {
	        return [
	            'tabs' => [
	                ...
			],
			'settings' => [
				...
			];
	    }	
	...
	}
Метод возвращает ассоциативный массив с 2мя ключами. В `'tabs'` находится массивы с конфигурацией вкладок и полей страницы настроек модуля, в `'settings'` – другие общие настройки. 
###Структура `'settings'`
На данный момент в `'settings'` может находиться лишь один параметр `\Rover\Fadmin\Options::SETTINGS__CHECKBOX_BOOLEAN`. Он отвечает за то, как будет возвращаться значение опции типа `Input::TYPE__CHECKBOX` (чекбокс). Если параметр не указан, либо равен `false`, то возвращаемое значение опции будет `'Y'` или `'N'`, а если параметр равен `true`, то, соответственно, – `true` или `false`.
###Структура `'tabs'`
Рассмотрим структуру массивов, которые находятся по ключу `'tabs'` в демо-классе:

	...
	'tabs' => [
	   [
	      'name'          => 'test_tab',
	      'label'         => 'test tab',
	      'description'   => 'test tab description',
	      'siteId'        => 's1',
	      'inputs'        => [
	         [
	            'type'      => Input::TYPE__HEADER,
	            'name'      => 'input_header',
	            'label'     => 'First tab header',
	         ],
	         [
	            'type'      => Input::TYPE__TEXTAREA,
	            'name'      => 'input_textarea',
	            'label'     => 'input textarea 3 rows 20 cols',
	            'default'   => 'default text',
	            'rows'      => 3,
	            'cols'      => 20,
	            'help'      => 'textarea help',
	         ],
	         [
	            'type'      => Input::TYPE__ADD_PRESET,
	            'name'      => 'add_preset',
	            'label'     => 'add preset',
	            'default'   => 'new preset default name',
	            'popup'     => 'add preset popup' // false - not show
	         ]
	      ]
	   ],
	...
Каждый массив, находящийся в `'tabs'` описывает одну вкладку либо шаблон вкладки для пресета. Разберем ключи этого массива:
* `name` – уникальное имя вкладки в системе, обязательное;
* `label` – название вкладки, обязательное;
* `description` – описание вкладки, не обязательное;
* `siteId` – идентификатор сайта, к которому относятся настройки на вкладке, не обязательное, если не указан, то настройки используются для всех сайтов;
* `preset` – если указан и равен true, то это говорит о том, что данная вкладка является шаблоном пресета.
* `inputs` – массив с конфигурацией опций, которые будут отображены на вкладке;

Опции могут быть различных типов (`namespace Rover\Fadmin\Inputs\Input`). Простые типы:
* `Input::TYPE__CHECKBOX` – чекбокс;
* `Input::TYPE__CLOCK` – выбор времени;
* `Input::TYPE__COLOR` – выбор цвета;
* `Input::TYPE__FILE` – загрузка файла (в т.ч. изображения);
* `Input::TYPE__HEADER` – заголовок, не может иметь значение;
* `Input::TYPE__HIDDEN` – скрытое поле;
* `Input::TYPE__IBLOCK` – выбор инфоблока;
* `Input::TYPE__LABEL` – вывод текста, не может иметь значение;
* `Input::TYPE__NUMBER` – строка для ввода числа;
* `Input::TYPE__SELECTBOX` – выпадающий список;
* `Input::TYPE__SUBMIT` – отправка формы;
* `Input::TYPE__TEXT` – строка для ввода текста;
* `Input::TYPE__TEXTAREA` – поле для ввода текста.

Специальные типы:
* `Input::TYPE__ADD_PRESET` – добавление пресета;
* `Input::TYPE__REMOVE_PRESET` – удаление пресета;
* `Input::TYPE__CUSTOM` – пользовательский элемент.

###Конфигурация опций в ключе `'inputs'`
Описание каждой опции имеет обязательные и не обязательные параметры.  Обязательные:
* `type` – тип опции 
* `name` – уникальное имя опции в системе, не обязательное для элементов, которые не могут иметь значение (`Input::TYPE__HEADER` и `Input::TYPE__LABEL`)
* `label` – название опции, которое будет отображено на вкладке

Необязательные параметры зависят от типа опции и если они не указаны явно, то для них берется значение по умолчанию. Общими необязательными параметрами являются:
* `id` – id элемента на вкладке, если не указан, то берется из параметра name;
* `default` – значение опции по умолчанию, так же является текстом, который выводят элементы типа `Input::TYPE__HEADER` и `Input::TYPE__LABEL`;
* `help` – подпись под опцией со справочной информацией.

##Получение значений опций
Для получения значения опции по ее имени в вашем классе настроек будут доступны 2 метода:
* `getNormalValue($inputName, $siteId = '', $reload = false)` - для получения значения обычной опции
* `getPresetValue($inputName, $presetId, $siteId = '', $reload = false)` - для поличения значения опции из пресета

Рассмотрим аргументы:
* `$inputName` – имя опции в системе
* `$presetId` – номер пресета
* `$siteId` – идентификатор сайта
* `$reload` – при первом обращении значение опции попадает в кеш и при следующих обращениях по умолчанию берется из него. Если аргумент равен true, то значение повторно берется из базы.

На практике бывает удобно сделать обёртку над этими методами, например, как это сделано в демо-классе. Для получения значения обычной опции:
	
	...
	public function getTextareaValueS1($reload = false)
	{
	   return $this->getNormalValue('input_textarea', 's1', $reload);
	}
	...
Для получения значения опции из пресета:

	...
	public function getS1PresetColor($presetId, $reload = false)
	{
	   return $this->getPresetValue('preset_color', $presetId, 's1', $reload);
	}
	...
##Работа с пресетами
Для создания пресета необходимо указать параметры его вкладки в конфигурации. В параметрах вкладки ключ `'preset'` должен быть равен `true`. Рассмотрим пример конфигурации кладки пресета из демо-класса для сайта `s1`:

	...
	[
		'name'          => 'presetTab',
		'label'         => 'Preset',
		'preset'        => true,
		'description'   => 'This is a description of preset tab',
		'siteId'        => 's1',
		'inputs'        => [
		[
			'type'      => Input::TYPE__HEADER,
			'name'      => 'preset_header',
			'label'     => 'Preset header',
		],
		[
			'type'      => Input::TYPE__COLOR,
			'name'      => 'preset_color',
			'label'     => 'preset color',
			'default'   => '#FFAA00',
			'help'      => 'color help',
		],
		[
			'type'      => Input::TYPE__REMOVE_PRESET,
			'name'      => 'remove_preset',
			'label'     => 'remove_preset',
			'popup'     => 'Are you sure?',
			]
		],
	],
	...
Для возможности удаления пресета вы можете на его вкладке разместить и настроить элемент типа `Input::TYPE__REMOVE_PRESET`. Для возможности создавать пресет вы можете разместить и настроить элемент типа `Input::TYPE__ADD_PRESET` на вкладке, которая не является пресетом.

Для каждого сайта может быть использован только один шаблон пресета. Если в конфигурации их несколько, то все последующие, кроме первого, будут игнорироваться. При создании пресета будет браться шаблон для того сайта, на вкладке которого была нажата кнопка `Input::TYPE__ADD_PRESET`. Пока для сайта не создан ни один пресет, шаблон его вкладки в настройках отображен не будет.
##События
Для возможности более гибкой логики работы административной части вашего модуля в фреймворке предусмотрена система событий. Название всех событий определены в классе `\Rover\Fadmin\Options` в константах, начинающихся на `EVENT__`.
 
Чтобы использовать событие в своём модуле, вам необходимо создать соответствующий метод в вашем классе, унаследованном от `\Rover\Fadmin\Options`. Если метод, определённый в константе, начинающейся с `EVENT__BEFORE_`, вернет false, то соответствующее действие выполнено не будет. Это не относится к событию `'beforeGetTabInfo'`. Данное событие позволяет только изменить информацию о вкладке, но не отменить ее отображение.
##Сообщения
Для информирования администратора о непредвиденных ситуациях в вашем классе, унаследованном от `\Rover\Fadmin\Options` доступен метод `public addMessage($message, $type = 'OK')`. Параметр `$type` может принимать значения `'OK'` и `'ERROR'`.

Сообщения выводятся над административной страницей настроек вашего модуля.
##Контакты
По всем вопросам вы можете связаться со мной через форму на сайте http://rover-it.me, либо по email: rover.webdev@gmail.com. Гитхаб проекта: https://github.com/pavelshulaev/fadmin